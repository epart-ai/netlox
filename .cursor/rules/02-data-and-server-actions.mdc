---
description: Data access & Server Actions — validation, auth, loaders
globs: ["app/**/*.{ts,tsx}", "src/app/**/*.{ts,tsx}", "src/entities/**/*.{ts,tsx}", "src/features/**/*.{ts,tsx}"]
alwaysApply: true
---

- **로더/액션 분리**: RSC 로더는 `unstable_cache`로 감싸고, Server Action은 `"use server"` 파일에 분리.
- **입력 검증**: Server Action은 Zod로 입력을 파싱/검증하고 실패 시 표준 에러를 던집니다.
- **권한 선체크**: 도메인 서비스 호출 전 `assert*` 권한 함수를 먼저 호출.
- **경로 표준**: `Server Action/Route Handler → entities/features 서비스 → UI`.
- **최신화**: 쓰기 후 관련 `revalidateTag` 또는 `revalidatePath` 호출.
- **클라이언트 경계**: 클라이언트 컴포넌트에서 Server Action만 호출하고 DB/서비스 직접 임포트 금지.

Do:

- 로더의 외부 호출은 캐시/타임아웃/리트라이가 설정된 헬퍼를 사용하고, 태그/재검증 정책을 명확히.
- Server Action은 순수함수 형태 유지(부수효과 최소화), 에러는 표준화된 타입으로 매핑.

Don't:

- 신뢰할 수 없는 입력을 그대로 전달하거나, 액션 내부에서 클라이언트 전용 API를 호출하지 않습니다.
